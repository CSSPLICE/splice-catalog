<!DOCTYPE html>
<html>
  <%- include('../partials/head') -%>
  <link rel="stylesheet" href="/css/style.css">
  <%- include('../partials/header') -%>

  <body>
    <div class="container search-sidebar-layout">

      <%- include('../partials/filter') -%>

      <%
        const q = (typeof query === 'string') ? query : '';
        const selectedFeatures = Array.isArray(features)
          ? features
          : (features ? [features] : []);
      %>

      <main class="search-content">

        <div style="margin-bottom: 1rem;">
          <!-- add button to download the JSON results -->
          <form action="/export/search" method="get" style="display:inline;">
            <input type="hidden" name="query" value="<%= q %>">
            <% selectedFeatures.forEach(t => { %>
              <input type="hidden" name="features" value="<%= t %>">
            <% }) %>

            <button type="submit" class="btn btn-primary"> Download results </button>
          </form>
        </div>


        <%- include('../pages/table', { items: results || [], isSearchPage: true }) %>


        <div class="pagination">
        </div>
      </main>
    </div>

    <script>
      const allItems = <%- JSON.stringify(results || []) %>;
      let currentItems = allItems;
    </script>
    <script src="/js/searchparams.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const modal = document.getElementById("descriptionModal");
        const modalText = document.getElementById("fullDescription");

        document.querySelectorAll(".short-description").forEach((el) => {
          el.addEventListener("click", () => {
            modalText.textContent = el.getAttribute("data-description") || "Detailed Description.";
            modal.style.display = "block";
          });
        });

        document.querySelector(".close").addEventListener("click", () => {
          modal.style.display = "none";
        });
      });
    </script>
  </body>

  <%- include('../partials/footer') -%>
</html>
